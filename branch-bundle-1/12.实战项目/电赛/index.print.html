<!DOCTYPE html>
<html lang="zh" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.120.4">
    <meta name="generator" content="Relearn 5.23.2+tip">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="电赛 :: Maloudown">
    <meta name="twitter:description" content="以下笔记皆基于HAL库。 新建STM32CubeMX工程步骤 创建工程中如果勾选MCO表示向外部输出时钟， 输出的是哪一个引脚可以查看，如下图。 外">
    <meta property="og:title" content="电赛 :: Maloudown">
    <meta property="og:description" content="以下笔记皆基于HAL库。 新建STM32CubeMX工程步骤 创建工程中如果勾选MCO表示向外部输出时钟， 输出的是哪一个引脚可以查看，如下图。 外">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://wungmeisilong.github.io/branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/">
    <meta property="article:section" content="12.实战项目 :: Maloudown">
    <meta property="article:published_time" content="2024-05-14T22:22:09+08:00">
    <meta property="article:modified_time" content="2024-05-14T22:22:09+08:00">
    <meta property="og:site_name" content="Maloudown">
    <title>电赛 :: Maloudown</title>
    <link href="https://wungmeisilong.github.io/branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/" rel="canonical" type="text/html" title="电赛 :: Maloudown">
    <link href="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/index.xml" rel="alternate" type="application/rss+xml" title="电赛 :: Maloudown">
    <link href="../../../images/favicon.png?1743696567" rel="icon" type="image/png">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="../../../css/fontawesome-all.min.css?1743696568" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fontawesome-all.min.css?1743696568" rel="stylesheet"></noscript>
    <link href="../../../css/nucleus.css?1743696568" rel="stylesheet">
    <link href="../../../css/auto-complete.css?1743696568" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/auto-complete.css?1743696568" rel="stylesheet"></noscript>
    <link href="../../../css/perfect-scrollbar.min.css?1743696568" rel="stylesheet">
    <link href="../../../css/fonts.css?1743696568" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fonts.css?1743696568" rel="stylesheet"></noscript>
    <link href="../../../css/theme.css?1743696568" rel="stylesheet">
    <link href="../../../css/theme-auto.css?1743696568" rel="stylesheet" id="R-variant-style">
    <link href="../../../css/variant.css?1743696568" rel="stylesheet">
    <link href="../../../css/print.css?1743696568" rel="stylesheet" media="print">
    <link href="../../../css/format-print.css?1743696568" rel="stylesheet">
    <link href="../../../css/ie.css?1743696568" rel="stylesheet">
    <script src="../../../js/url.js?1743696568"></script>
    <script src="../../../js/variant.js?1743696568"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="../../../index.search.js";
      var root_url="../../../";
      var baseUri=root_url.replace(/\/$/, '');
      window.relearn = window.relearn || {};
      window.relearn.baseUriFull='https:\/\/wungmeisilong.github.io/';
      // variant stuff
      window.variants && variants.init( [ 'auto', 'zen-light', 'zen-dark', 'neon', 'zen-light' ] );
      // translations
      window.T_Copy_to_clipboard = `复制到剪贴板`;
      window.T_Copied_to_clipboard = `复制到剪贴板！`;
      window.T_Copy_link_to_clipboard = `将链接复制到剪贴板`;
      window.T_Link_copied_to_clipboard = `链接复制到剪贴板！`;
      window.T_Reset_view = `重置视图`;
      window.T_View_reset = `查看重置！`;
      window.T_No_results_found = `找不到"{0}"的结果`;
      window.T_N_results_found = `为"{0}"找到 {1} 个结果`;
    </script>
  </head>
  <body class="mobile-support print" data-url="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide">
              <button class="topbar-control" onclick="toggleNav()" type="button" title="导航 (CTRL&#43;ALT&#43;n)">
                <i class="fa-fw fas fa-bars"></i>
              </button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../"><span itemprop="name">Maloudown</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../branch-bundle-1/"><span itemprop="name">一、博客文章</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/"><span itemprop="name">12.实战项目</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">电赛</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
<div class=" taxonomy-tags term-list cstyle  tags" title="Tags" style="--VARIABLE-TAGS-BG-color: var(--INTERNAL-TAG-BG-color);">
  <ul>
    <li><a class="term-link" href="../../../tags/stm32%E5%AD%A6%E4%B9%A0/">STM32学习</a></li>
  </ul>
</div>
            </header>
<h1 id="电赛">电赛</h1>

<hr>
<p><strong>以下笔记皆基于HAL库。</strong></p>
<h2 id="新建stm32cubemx工程步骤">新建STM32CubeMX工程步骤</h2>
<p><a href="#R-image-d6f5959ccdee03a75ca1cb7bb69c753d" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image.png" alt="步骤" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d6f5959ccdee03a75ca1cb7bb69c753d"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image.png" alt="步骤" class="lightbox-image        " loading="lazy"></a></p>
<p>创建工程中如果勾选MCO表示向外部输出时钟，
<a href="#R-image-ade8c67fc8c94b321f414e7b500ede97" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-1.png" alt="打钩" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ade8c67fc8c94b321f414e7b500ede97"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-1.png" alt="打钩" class="lightbox-image        " loading="lazy"></a>
输出的是哪一个引脚可以查看，如下图。
<a href="#R-image-dd2149794127d82f159327adfaba8dbc" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-2.png" alt="PA8" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-dd2149794127d82f159327adfaba8dbc"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-2.png" alt="PA8" class="lightbox-image        " loading="lazy"></a></p>
<p>外部时钟设置
<a href="#R-image-a6605d7afa8e8c43ac9539cfdb0545ac" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-3.png" alt="时钟" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a6605d7afa8e8c43ac9539cfdb0545ac"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-3.png" alt="时钟" class="lightbox-image        " loading="lazy"></a></p>
<p>工程设置
<a href="#R-image-aa994ed9c97b9ad9cb8f5804fe17f995" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-4.png" alt="项目设置" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-aa994ed9c97b9ad9cb8f5804fe17f995"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-4.png" alt="项目设置" class="lightbox-image        " loading="lazy"></a></p>
<p>如果Application Structure设置为Basic，那么会把下面的两个文件分开放
<a href="#R-image-f234d3333e3212709b221e659a64c953" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-5.png" alt="xx " class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f234d3333e3212709b221e659a64c953"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-5.png" alt="xx " class="lightbox-image        " loading="lazy"></a>
否则项目会把两个文件放在一个文件夹里，如Core</p>
<p>最后还需要设置Code Generator，如下：
<a href="#R-image-70491d1d9bad05b46bb7ca18686c4034" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-6.png" alt="Code Generator" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-70491d1d9bad05b46bb7ca18686c4034"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-6.png" alt="Code Generator" class="lightbox-image        " loading="lazy"></a></p>
<h2 id="时钟">时钟</h2>
<p>1.初识时钟周期</p>
<p>2.时钟树
<a href="#R-image-1b6bd3c59be1fcba4c0eb635c1586826" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-7.png" alt="时钟树" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1b6bd3c59be1fcba4c0eb635c1586826"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-7.png" alt="时钟树" class="lightbox-image        " loading="lazy"></a>
<a href="#R-image-84b50cdaa241be2eb73323db27ceb665" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-8.png" alt="时钟树1" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-84b50cdaa241be2eb73323db27ceb665"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-8.png" alt="时钟树1" class="lightbox-image        " loading="lazy"></a>
<a href="#R-image-437175381f453d1eb3737728e21b2d12" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-9.png" alt="时钟树2" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-437175381f453d1eb3737728e21b2d12"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-9.png" alt="时钟树2" class="lightbox-image        " loading="lazy"></a></p>
<p>3.时钟配置步骤
<a href="#R-image-59c742eb3ec972667f21db0f86469a94" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-10.png" alt="步骤" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-59c742eb3ec972667f21db0f86469a94"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-10.png" alt="步骤" class="lightbox-image        " loading="lazy"></a></p>
<p>4.外设时钟使能和失能</p>
<p>5.sys_stm32_cloc_init()函数</p>
<ul>
<li>
<p>HAL_RCC_OscConfig()</p>
<ul>
<li>HSE高速外设振荡器</li>
<li>LSE</li>
<li>RC振荡器，随着电压的变化而变化，所以需要一个检验值</li>
<li>PLL锁相环</li>
</ul>
</li>
<li>
<p>HAL_RCC_ClockConfig()
<a href="#R-image-431fc54c0ce1db2618785bac31238936" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-12.png" alt="alt text" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-431fc54c0ce1db2618785bac31238936"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-12.png" alt="alt text" class="lightbox-image        " loading="lazy"></a>
<a href="#R-image-d28736b561cdaf6d78ccb3ddb7ab3b84" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-11.png" alt="alt text" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d28736b561cdaf6d78ccb3ddb7ab3b84"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-11.png" alt="alt text" class="lightbox-image        " loading="lazy"></a></p>
<ul>
<li>第一个参数
<ul>
<li>结构体中的第一个参数里的HCLK是指AHB总线、PCLK1是指APB1总线、PCLK2是指APB2总线，这个配置表示要配那条总线的时钟。</li>
</ul>
</li>
<li>第二个形参
<a href="#R-image-c0f5fa471e0235d9508cf260e5bbabe4" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-14.png" alt="alt text" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c0f5fa471e0235d9508cf260e5bbabe4"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-14.png" alt="alt text" class="lightbox-image        " loading="lazy"></a>
<ul>
<li>F1系统时钟72MHz,如果使用72MHz访问闪存（Flash）那么是需要等待的，因为闪存的允许最大时钟频率是42MHz,所以需要等待，等待多少个周期需要下图
<a href="#R-image-5c4291cf60b42d7f7be33af27f1a379a" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-13.png" alt="alt text" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5c4291cf60b42d7f7be33af27f1a379a"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-13.png" alt="alt text" class="lightbox-image        " loading="lazy"></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>6.SYSTEN文件夹</p>
<ul>
<li>sys文件夹
<a href="#R-image-c2f8e6274abeb172c927c5fb92b690fa" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-15.png" alt="sys表" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c2f8e6274abeb172c927c5fb92b690fa"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-15.png" alt="sys表" class="lightbox-image        " loading="lazy"></a></li>
</ul>
<h3 id="nvic介绍">NVIC介绍</h3>
<h4 id="中断基本概念">中断基本概念</h4>
<p><a href="#R-image-edc9f5e2c3047977ee39b8bdc887d6d7" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-17.png" alt="概念" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-edc9f5e2c3047977ee39b8bdc887d6d7"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-17.png" alt="概念" class="lightbox-image        " loading="lazy"></a>
<a href="#R-image-62b70b518a4f37fa00361fe398a315b0" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-18.png" alt="中断表" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-62b70b518a4f37fa00361fe398a315b0"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-18.png" alt="中断表" class="lightbox-image        " loading="lazy"></a></p>
<h4 id="中断向量表">中断向量表</h4>
<p><a href="#R-image-82050263e868a165efba29963551f370" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-16.png" alt="alt text" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-82050263e868a165efba29963551f370"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-16.png" alt="alt text" class="lightbox-image        " loading="lazy"></a></p>
<h4 id="文件里的中断在哪里呢">文件里的中断在哪里呢？</h4>
<p>在文件<strong>startup_stm32f10x_hd.s</strong>中这里列出内部中断，外部中断就在内部中断之下，这里不再列出。</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>__Vectors       DCD     __initial_sp               ; Top of Stack
</span></span><span style="display:flex;"><span>                DCD     Reset_Handler              ; Reset Handler
</span></span><span style="display:flex;"><span>                DCD     NMI_Handler                ; NMI Handler
</span></span><span style="display:flex;"><span>                DCD     HardFault_Handler          ; Hard Fault Handler
</span></span><span style="display:flex;"><span>                DCD     MemManage_Handler          ; MPU Fault Handler
</span></span><span style="display:flex;"><span>                DCD     BusFault_Handler           ; Bus Fault Handler
</span></span><span style="display:flex;"><span>                DCD     UsageFault_Handler         ; Usage Fault Handler
</span></span><span style="display:flex;"><span>                DCD     <span style="color:#ae81ff">0</span>                          ; Reserved
</span></span><span style="display:flex;"><span>                DCD     <span style="color:#ae81ff">0</span>                          ; Reserved
</span></span><span style="display:flex;"><span>                DCD     <span style="color:#ae81ff">0</span>                          ; Reserved
</span></span><span style="display:flex;"><span>                DCD     <span style="color:#ae81ff">0</span>                          ; Reserved
</span></span><span style="display:flex;"><span>                DCD     SVC_Handler                ; SVCall Handler
</span></span><span style="display:flex;"><span>                DCD     DebugMon_Handler           ; Debug Monitor Handler
</span></span><span style="display:flex;"><span>                DCD     <span style="color:#ae81ff">0</span>                          ; Reserved
</span></span><span style="display:flex;"><span>                DCD     PendSV_Handler             ; PendSV Handler
</span></span><span style="display:flex;"><span>                DCD     SysTick_Handler            ; SysTick Handler</span></span></code></pre></div><h4 id="中断寄存器">中断寄存器</h4>
<p><a href="#R-image-f8854d37aba41917d2e135bc2b59474a" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-20.png" alt="中断寄存器" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f8854d37aba41917d2e135bc2b59474a"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-20.png" alt="中断寄存器" class="lightbox-image        " loading="lazy"></a></p>
<h4 id="中断原理">中断原理</h4>
<p><a href="#R-image-51ab115e5edc962dd8b60fa4fa8b8ff2" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-21.png" alt="原理" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-51ab115e5edc962dd8b60fa4fa8b8ff2"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-21.png" alt="原理" class="lightbox-image        " loading="lazy"></a></p>
<h3 id="中断优先级">中断优先级</h3>
<p><a href="#R-image-ee0cb9eb2fc3b15e7a9ce8b22028d0a5" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-22.png" alt="优先级" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ee0cb9eb2fc3b15e7a9ce8b22028d0a5"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-22.png" alt="优先级" class="lightbox-image        " loading="lazy"></a>
<a href="#R-image-94bf29bbf1a5061e8053e3cc79ee00e7" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-23.png" alt="优先级" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-94bf29bbf1a5061e8053e3cc79ee00e7"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-23.png" alt="优先级" class="lightbox-image        " loading="lazy"></a>
响应优先级又叫子优先级</p>
<p><strong>中断的抢占优先级由AICR寄存器的后三位控制，而响应优先级由IPRx寄存器的后四位控制</strong>，最终分配结果参考下面的表格
<a href="#R-image-5e388896c82f3994231b98a8de505291" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-24.png" alt="表" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5e388896c82f3994231b98a8de505291"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-24.png" alt="表" class="lightbox-image        " loading="lazy"></a></p>
<p>中断一般只设置一次，设置多次可能会导致中断紊乱，一般以最后一次的中断设置为准，详细说明参考手册4.4.5</p>
<p>中断执行的顺序：抢占优先级（先执行数值小的）————响应优先级（先执行数值小的）————自然优先级（先执行数值大的）</p>
<h3 id="nvic-的使用">NVIC 的使用</h3>
<hr>
<p><strong>以下笔记皆基于标准库。</strong></p>
<h2 id="标准库中额中断">标准库中额中断</h2>
<p><a href="#R-image-21fbef1ed3b856fcbcd7b0bb133460c4" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-25.png" alt="alt text" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-21fbef1ed3b856fcbcd7b0bb133460c4"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-25.png" alt="alt text" class="lightbox-image        " loading="lazy"></a></p>
<h3 id="extiextern-interrupt外部中断">EXTI（Extern Interrupt）外部中断</h3>
<p>EXTI可以监测指定GPIO口的电平信号，当其指定的GPIO口产生电平变化时，EXTI将立即向NVIC发出中断申请，经过NVIC裁决后即可中断CPU主程序，使CPU执行EXTI对应的中断程序</p>
<p>简而言之，gpio电平发生变化时，申请外部中断。</p>
<ul>
<li><strong>支持的触发方式</strong>：上升沿/下降沿/双边沿/软件触发（<em>引脚没有发生变化，执行一段代码就申请中断</em>）</li>
<li><strong>支持的GPIO口</strong>：所有GPIO口，但相同的Pin不能同时触发中断（<em>如PA1，PB1，PC1不能同时触发中断</em>）</li>
<li><strong>通道数</strong>：16个GPIO_Pin，外加PVD输出、RTC闹钟、USB唤醒、以太网唤醒</li>
<li><strong>触发响应方式</strong>：中断响应/事件响应（<em>事件响应不会触发中断。而是触发别的外设操作。属于外设之间的联合工作</em>）</li>
</ul>
<h3 id="afio复用io口">AFIO复用IO口</h3>
<p>主要用于引脚复用功能的选择和重定义</p>
<p>在STM32中，AFIO主要完成两个任务：</p>
<ul>
<li>复用功能引脚重映射</li>
<li>中断引脚选择
<a href="#R-image-d0d41eb0fc419b8d45813ecf6c761f77" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-26.png" alt="GPIO口中断申请图" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d0d41eb0fc419b8d45813ecf6c761f77"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-26.png" alt="GPIO口中断申请图" class="lightbox-image        " loading="lazy"></a></li>
</ul>
<h3 id="exti实现代码">EXTI实现代码</h3>
<p>这段代码的中断端口是GPIOB_Pin14，所以需要将相关的传感器接到PB14这个端口</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">CountSensor_Init</span>(){
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//配置RCC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">RCC_APB2PeriphClockCmd</span>(RCC_APB2Periph_GPIOB,ENABLE);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//AFIO、
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">RCC_APB2PeriphClockCmd</span>(RCC_APB2Periph_AFIO,ENABLE);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//EXTI、一直打开着不用配置打开时钟
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">//NVIC  一直打开着不用配置打开时钟
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	
</span></span><span style="display:flex;"><span>	GPIO_InitTypeDef GPIO_InitStructure;
</span></span><span style="display:flex;"><span>	GPIO_InitStructure.GPIO_Mode<span style="color:#f92672">=</span>GPIO_Mode_IPU;
</span></span><span style="display:flex;"><span>	GPIO_InitStructure.GPIO_Pin<span style="color:#f92672">=</span>GPIO_Pin_14;
</span></span><span style="display:flex;"><span>	GPIO_InitStructure.GPIO_Speed<span style="color:#f92672">=</span>GPIO_Speed_50MHz;
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">GPIO_Init</span>(GPIOB,<span style="color:#f92672">&amp;</span>GPIO_InitStructure);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">GPIO_EXTILineConfig</span>(GPIO_PortSourceGPIOB,GPIO_PinSource14);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//EXTI
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	EXTI_InitTypeDef EXTI_InitStructure;
</span></span><span style="display:flex;"><span>	EXTI_InitStructure.EXTI_Line<span style="color:#f92672">=</span>EXTI_Line14;
</span></span><span style="display:flex;"><span>	EXTI_InitStructure.EXTI_LineCmd<span style="color:#f92672">=</span>ENABLE;
</span></span><span style="display:flex;"><span>	EXTI_InitStructure.EXTI_Mode<span style="color:#f92672">=</span>EXTI_Mode_Interrupt;
</span></span><span style="display:flex;"><span>	EXTI_InitStructure.EXTI_Trigger<span style="color:#f92672">=</span>EXTI_Trigger_Falling;
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">EXTI_Init</span>(<span style="color:#f92672">&amp;</span>EXTI_InitStructure);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//NVIC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	
</span></span><span style="display:flex;"><span>	NVIC_InitTypeDef NVIC_InitStructure;
</span></span><span style="display:flex;"><span>	NVIC_InitStructure.NVIC_IRQChannel<span style="color:#f92672">=</span>EXTI15_10_IRQn;
</span></span><span style="display:flex;"><span>	NVIC_InitStructure.NVIC_IRQChannelCmd<span style="color:#f92672">=</span>ENABLE;
</span></span><span style="display:flex;"><span>	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>	NVIC_InitStructure.NVIC_IRQChannelSubPriority<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">NVIC_Init</span>(<span style="color:#f92672">&amp;</span>NVIC_InitStructure);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">EXTI15_10_IRQHandler</span>(<span style="color:#66d9ef">void</span>){<span style="color:#75715e">//中断函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">EXTI_GetITStatus</span>(EXTI_Line14)<span style="color:#f92672">==</span> SET){
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">EXTI_ClearITPendingBit</span>(EXTI_Line14);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h2 id="定时器">定时器</h2>
<h3 id="timtimer定时器">TIM（Timer）定时器</h3>
<p>定时器可以对输入的时钟进行计数，并在计数值达到设定值时触发中断</p>
<p>16位计数器、预分频器、自动重装寄存器的时基单元，在72MHz计数时钟下可以实现最大59.65s的定时
不仅具备基本的定时中断功能，而且还包含内外时钟源选择、输入捕获、输出比较、编码器接口、主从触发模式等多种功能
根据复杂度和应用场景分为了高级定时器、通用定时器、基本定时器三种类型</p>
<h3 id="使用内部时钟源实现中断标准库中">使用内部时钟源实现中断（标准库中）</h3>
<p>在编写代码前先看看定时器的实现原理图</p>
<ul>
<li>基本定时器
<a href="#R-image-43cddcb4876daa59b3bef0980c85585a" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-27.png" alt="基本定时器" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-43cddcb4876daa59b3bef0980c85585a"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-27.png" alt="基本定时器" class="lightbox-image        " loading="lazy"></a></li>
<li>通用定时器
<a href="#R-image-ee755399cd9029aa9a6f915d11145add" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-28.png" alt="通用定时器" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ee755399cd9029aa9a6f915d11145add"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-28.png" alt="通用定时器" class="lightbox-image        " loading="lazy"></a></li>
<li>高级定时器（红色框出来的部分是高级定时器独有的）
<a href="#R-image-38ae36a58bd1cbdb758456df740d98b5" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-29.png" alt="高级定时器" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-38ae36a58bd1cbdb758456df740d98b5"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-29.png" alt="高级定时器" class="lightbox-image        " loading="lazy"></a></li>
</ul>
<p>此处主要参考通用计时器的结构图，下面是基于内部时钟RCC的定时器。</p>
<p>在 <strong>stm32f103xxx_rcc.c</strong> 文件对 <strong>RCC_APB1PeriphClockCmd</strong> 这样的介绍：</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  * @brief  Enables or disables the High Speed APB (APB2) peripheral clock.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  * @param  RCC_APB2Periph: specifies the APB2 peripheral to gates its clock.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  *   This parameter can be any combination of the following values:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  *     @arg RCC_APB2Periph_AFIO, RCC_APB2Periph_GPIOA, 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  ……
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  ……
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  ……+
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  */</span></span></span></code></pre></div><p>specifies the APB2 peripheral to gates its clock.即：指定APB 2外围设备到其时钟门。而这里的时钟门代码里选择了TIM2。</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Timer_Init</span>(<span style="color:#66d9ef">void</span>){
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//1.RCC 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">RCC_APB1PeriphClockCmd</span>(RCC_APB1Periph_TIM2,ENABLE);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//2.选择时基单元时钟源，
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">TIM_InternalClockConfig</span>(TIM2);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//3.时基单元
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;
</span></span><span style="display:flex;"><span>	TIM_TimeBaseInitStructure.TIM_ClockDivision<span style="color:#f92672">=</span>TIM_CKD_DIV1;		<span style="color:#75715e">//时钟分频，这里是1分频
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	TIM_TimeBaseInitStructure.TIM_CounterMode<span style="color:#f92672">=</span>TIM_CounterMode_Up;	<span style="color:#75715e">//计数方式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	TIM_TimeBaseInitStructure.TIM_Period<span style="color:#f92672">=</span><span style="color:#ae81ff">10000</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;					<span style="color:#75715e">//自动重装值，计数达到这个值后触发中断，然后重新开始计数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	TIM_TimeBaseInitStructure.TIM_Prescaler<span style="color:#f92672">=</span><span style="color:#ae81ff">7200</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;				<span style="color:#75715e">//预分频，计数频率，
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>																	<span style="color:#75715e">//假设计数为1s则自动重装值可设置为10000，预分频可设置为7200，公式为秒数=27MHz/PSC/ARR
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	TIM_TimeBaseInitStructure.TIM_RepetitionCounter<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;				<span style="color:#75715e">//重复计数数器高级定时器才有，这里设置为0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">TIM_TimeBaseInit</span>(TIM2,<span style="color:#f92672">&amp;</span>TIM_TimeBaseInitStructure);				<span style="color:#75715e">//时基单元设置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">TIM_ITConfig</span>(TIM2,TIM_IT_Update,ENABLE);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//4.中断输出控制 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">NVIC_PriorityGroupConfig</span>(NVIC_PriorityGroup_2);					<span style="color:#75715e">//抢占优先级,0-3， 响应优先级0-3，一个工程只设置一次
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//5.NVIC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	NVIC_InitTypeDef  NVIC_InitStructure;
</span></span><span style="display:flex;"><span>	NVIC_InitStructure.NVIC_IRQChannel<span style="color:#f92672">=</span>TIM2_IRQn;
</span></span><span style="display:flex;"><span>	NVIC_InitStructure.NVIC_IRQChannelCmd<span style="color:#f92672">=</span>ENABLE;
</span></span><span style="display:flex;"><span>	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>	NVIC_InitStructure.NVIC_IRQChannelSubPriority<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">NVIC_Init</span>(<span style="color:#f92672">&amp;</span>NVIC_InitStructure);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">TIM_Cmd</span>(TIM2,ENABLE);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">TIM2_IRQHandler</span>(<span style="color:#66d9ef">void</span>){
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">TIM_GetITStatus</span>(TIM2,TIM_IT_Update) <span style="color:#f92672">==</span> SET){
</span></span><span style="display:flex;"><span>		Num<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">TIM_ClearITPendingBit</span>(TIM2,TIM_IT_Update);
</span></span><span style="display:flex;"><span>	 }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h2 id="实现输出比较">实现输出比较</h2>
<h3 id="ocoutput-compare输出比较">OC（Output Compare）输出比较</h3>
<ul>
<li>
<p>输出比较可以通过比较CNT与CCR寄存器值的关系，来对输出电平进行置1、置0或翻转的操作，用于输出一定频率和占空比的<strong>PWM波形</strong></p>
</li>
<li>
<p>每个高级定时器和通用定时器都拥有4个输出比较通道</p>
</li>
<li>
<p>高级定时器的前3个通道额外拥有死区生成和互补输出的功能</p>
</li>
<li>
<p>OC：<strong>输出比较</strong></p>
</li>
<li>
<p>IC：<strong>输入比较</strong></p>
</li>
<li>
<p>CC：<strong>输入/输出比较</strong></p>
</li>
</ul>
<h3 id="pwm波形">PWM波形</h3>
<ul>
<li>PWM（Pulse Width Modulation）脉冲宽度调制，广泛应用于各种电子和电气系统中，用于控制功率转换、电机速度、信号传输等</li>
<li>在具有<a href="%E6%83%AF%E6%80%A7%E7%9A%84%E7%B3%BB%E7%BB%9F">^1</a>中，可以通过对一系列脉冲的宽度进行调制，来等效地获得所需要的模拟参量，常应用于电机控速等领域
<a href="%E4%BE%8B%E5%A6%82%E7%94%B5%E6%9C%BA%E8%BD%AC%E5%8A%A8%E6%9A%82%E5%81%9C%E5%90%8E%E4%B8%8D%E4%BC%9A%E9%A9%AC%E4%B8%8A%E5%81%9C%E6%AD%A2%EF%BC%8C%E8%80%8C%E6%98%AF%E8%BF%87%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E6%89%8D%E4%BC%9A%E5%81%9C%E6%AD%A2%E3%80%82">^1</a></li>
<li>PWM参数：
<ul>
<li>频率 = 1 / TS</li>
<li>占空比 = TON / TS</li>
<li>分辨率 = 占空比变化步距
<a href="#R-image-0a8d26558c3f8e81fdd01ca13cd15c14" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-31.png" alt="PWM" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0a8d26558c3f8e81fdd01ca13cd15c14"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-31.png" alt="PWM" class="lightbox-image        " loading="lazy"></a>
一些电平变化图可以等效为图中的虚线。
<a href="#R-image-b020f43831b6cdc499f9cc23ebb48969" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-30.png" alt="信息" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b020f43831b6cdc499f9cc23ebb48969"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-30.png" alt="信息" class="lightbox-image        " loading="lazy"></a></li>
</ul>
</li>
</ul>
<p><a href="#R-image-244d143839518984446d25245554ff06" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-33.png" alt="通用定时器结构图" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-244d143839518984446d25245554ff06"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-33.png" alt="通用定时器结构图" class="lightbox-image        " loading="lazy"></a>
上图框出来的部分具体如下图：
<a href="#R-image-7030f01dd2eff241953c1b67fb7b3e2b" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-32.png" alt="捕获/比较通道的输出部分" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7030f01dd2eff241953c1b67fb7b3e2b"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-32.png" alt="捕获/比较通道的输出部分" class="lightbox-image        " loading="lazy"></a></p>
<p>在信号通过比较后输出到CC1P，然后再输出到输出使用电路，输出使用电路的OC1可以查看<strong>引脚定义表</strong></p>
<p>在上图中需要注意的一些引文缩写：</p>
<ul>
<li><strong>REF</strong> 是reference的缩写。意思是 <strong>参考信号</strong></li>
</ul>
<h3 id="输出比较的设置">输出比较的设置</h3>
<p>设置的函数为</p>
<p><a href="#R-image-67c4d437f693e746d85103fcde59012e" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-34.png" alt="模式" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-67c4d437f693e746d85103fcde59012e"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-34.png" alt="模式" class="lightbox-image        " loading="lazy"></a></p>
<h3 id="pwm基本结构">PWM基本结构</h3>
<p>配置PWM的时候可以参考下面的图，
<a href="#R-image-974071841e9950e429ed540ee6b8cb3a" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-35.png" alt="结构图" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-974071841e9950e429ed540ee6b8cb3a"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-35.png" alt="结构图" class="lightbox-image        " loading="lazy"></a>
图中的参考坐标系图红色线表示CCR的值，蓝色线表示CNT的值，黄色线表示自动重装载值即ARR。
了解了这点后我们再看看PWM的是如何计算的，如下公式</p>
<p><strong>PWM频率：</strong>
[ \text{Freq} = \frac{CKPSC}{(PSC + 1) \times (ARR + 1)} ]
可以看出PWM的频率等于CNT的更新频率</p>
<p><strong>PWM占空比：</strong>
[ \text{Duty} = \frac{CCR}{(ARR + 1)} ]</p>
<p><strong>PWM分辨率：</strong>
[ \text{Reso} = \frac{1}{(ARR + 1)} ]</p>
<h3 id="代码编写">代码编写</h3>
<p><a href="#R-image-2bd1b8070e6e241ea5d7030021109d1b" class="lightbox-link"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-36.png" alt="高级定时器" class="figure-image        " style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2bd1b8070e6e241ea5d7030021109d1b"><img src="../../../branch-bundle-1/12.%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%94%B5%E8%B5%9B/image-36.png" alt="高级定时器" class="lightbox-image        " loading="lazy"></a></p>

<div class="box attachments cstyle default" style="--VARIABLE-BOX-color: fuchsia;">
  <div class="box-label"><i class="fab fa-hackerrank"></i> 附件</div>
  <ul class="box-content attachments-files">
  </ul>
</div>

            <footer class="footline">
<div class=" taxonomy-categories term-list cstyle  " title="Categories" style="--VARIABLE-TAGS-BG-color: var(--INTERNAL-TAG-BG-color);">
  <i class="fa-fw fas fa-layer-group"></i>
  <ul>
    <li><a class="term-link" href="../../../categories/b5-%E6%AF%94%E8%B5%9B/">B5-比赛</a></li>
    <li><a class="term-link" href="../../../categories/x1-%E9%A1%B9%E7%9B%AE/">X1-项目</a></li>
  </ul>
</div>
            </footer>
          </article>

        </div>
      </main>
    </div>
    <script src="../../../js/clipboard.min.js?1743696568" defer></script>
    <script src="../../../js/perfect-scrollbar.min.js?1743696568" defer></script>
    <script src="../../../js/theme.js?1743696568" defer></script>
  </body>
</html>
